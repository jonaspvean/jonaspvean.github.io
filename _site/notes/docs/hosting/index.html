<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body>
<p>Quartz effectively turns your Markdown files and other resources into a bundle of HTML, JS, and CSS files (a website!).</p>

<p>However, if you’d like to publish your site to the world, you need a way to host it online. This guide will detail how to deploy with common hosting providers but any service that allows you to deploy static HTML should work as well.</p>

<blockquote>
  <p>[!warning]
The rest of this guide assumes that you’ve already created your own GitHub repository for Quartz. If you haven’t already, [[setting up your GitHub repository|make sure you do so]].</p>
</blockquote>

<blockquote>
  <p>[!hint]
Some Quartz features (like [[RSS Feed]] and sitemap generation) require <code class="language-plaintext highlighter-rouge">baseUrl</code> to be configured properly in your [[configuration]] to work properly. Make sure you set this before deploying!</p>
</blockquote>

<h2 id="cloudflare-pages">Cloudflare Pages</h2>

<ol>
  <li>Log in to the <a href="https://dash.cloudflare.com/" rel="external nofollow noopener" target="_blank">Cloudflare dashboard</a> and select your account.</li>
  <li>In Account Home, select <strong>Workers &amp; Pages</strong> &gt; <strong>Create application</strong> &gt; <strong>Pages</strong> &gt; <strong>Connect to Git</strong>.</li>
  <li>Select the new GitHub repository that you created and, in the <strong>Set up builds and deployments</strong> section, provide the following information:</li>
</ol>

<table>
  <thead>
    <tr>
      <th>Configuration option</th>
      <th>Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Production branch</td>
      <td><code class="language-plaintext highlighter-rouge">v4</code></td>
    </tr>
    <tr>
      <td>Framework preset</td>
      <td><code class="language-plaintext highlighter-rouge">None</code></td>
    </tr>
    <tr>
      <td>Build command</td>
      <td><code class="language-plaintext highlighter-rouge">npx quartz build</code></td>
    </tr>
    <tr>
      <td>Build output directory</td>
      <td><code class="language-plaintext highlighter-rouge">public</code></td>
    </tr>
  </tbody>
</table>

<p>Press “Save and deploy” and Cloudflare should have a deployed version of your site in about a minute. Then, every time you sync your Quartz changes to GitHub, your site should be updated.</p>

<p>To add a custom domain, check out <a href="https://developers.cloudflare.com/pages/platform/custom-domains/" rel="external nofollow noopener" target="_blank">Cloudflare’s documentation</a>.</p>

<blockquote>
  <p>[!warning]
Cloudflare Pages performs a shallow clone by default, so if you rely on <code class="language-plaintext highlighter-rouge">git</code> for timestamps, it is recommended that you add <code class="language-plaintext highlighter-rouge">git fetch --unshallow &amp;&amp;</code> to the beginning of the build command (e.g., <code class="language-plaintext highlighter-rouge">git fetch --unshallow &amp;&amp; npx quartz build</code>).</p>
</blockquote>

<h2 id="github-pages">GitHub Pages</h2>

<p>In your local Quartz, create a new file <code class="language-plaintext highlighter-rouge">quartz/.github/workflows/deploy.yml</code>.</p>

<p>```yaml title=”quartz/.github/workflows/deploy.yml”
name: Deploy Quartz site to GitHub Pages</p>

<p>on:
  push:
    branches:
      - v4</p>

<p>permissions:
  contents: read
  pages: write
  id-token: write</p>

<p>concurrency:
  group: “pages”
  cancel-in-progress: false</p>

<p>jobs:
  build:
    runs-on: ubuntu-22.04
    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0 # Fetch all history for git info
      - uses: actions/setup-node@v3
        with:
          node-version: 18.14
      - name: Install Dependencies
        run: npm ci
      - name: Build Quartz
        run: npx quartz build
      - name: Upload artifact
        uses: actions/upload-pages-artifact@v2
        with:
          path: public</p>

<p>deploy:
    needs: build
    environment:
      name: github-pages
      url: $
    runs-on: ubuntu-latest
    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v2</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
Then:

1. Head to "Settings" tab of your forked repository and in the sidebar, click "Pages". Under "Source", select "GitHub Actions".
2. Commit these changes by doing `npx quartz sync`. This should deploy your site to `&lt;github-username&gt;.github.io/&lt;repository-name&gt;`.

&gt; [!hint]
&gt; If you get an error about not being allowed to deploy to `github-pages` due to environment protection rules, make sure you remove any existing GitHub pages environments.
&gt;
&gt; You can do this by going to your Settings page on your GitHub fork and going to the Environments tab and pressing the trash icon. The GitHub action will recreate the environment for you correctly the next time you sync your Quartz.

&gt; [!info]
&gt; Quartz generates files in the format of `file.html` instead of `file/index.html` which means the trailing slashes for _non-folder paths_ are dropped. As GitHub pages does not do this redirect, this may cause existing links to your site that use trailing slashes to break. If not breaking existing links is important to you (e.g. you are migrating from Quartz 3), consider using [[#Cloudflare Pages]].

### Custom Domain

Here's how to add a custom domain to your GitHub pages deployment.

1. Head to the "Settings" tab of your forked repository.
2. In the "Code and automation" section of the sidebar, click "Pages".
3. Under "Custom Domain", type your custom domain and click "Save".
4. This next step depends on whether you are using an apex domain (`example.com`) or a subdomain (`subdomain.example.com`).
   - If you are using an apex domain, navigate to your DNS provider and create an `A` record that points your apex domain to GitHub's name servers which have the following IP addresses:
     - `185.199.108.153`
     - `185.199.109.153`
     - `185.199.110.153`
     - `185.199.111.153`
   - If you are using a subdomain, navigate to your DNS provider and create a `CNAME` record that points your subdomain to the default domain for your site. For example, if you want to use the subdomain `quartz.example.com` for your user site, create a `CNAME` record that points `quartz.example.com` to `&lt;github-username&gt;.github.io`.

![[dns records.png]]_The above shows a screenshot of Google Domains configured for both `jzhao.xyz` (an apex domain) and `quartz.jzhao.xyz` (a subdomain)._

See the [GitHub documentation](https://docs.github.com/en/pages/configuring-a-custom-domain-for-your-github-pages-site/managing-a-custom-domain-for-your-github-pages-site#configuring-a-subdomain) for more detail about how to setup your own custom domain with GitHub Pages.

&gt; [!question] Why aren't my changes showing up?
&gt; There could be many different reasons why your changes aren't showing up but the most likely reason is that you forgot to push your changes to GitHub.
&gt;
&gt; Make sure you save your changes to Git and sync it to GitHub by doing `npx quartz sync`. This will also make sure to pull any updates you may have made from other devices so you have them locally.

## Vercel

### Fix URLs

Before deploying to Vercel, a `vercel.json` file is required at the root of the project directory. It needs to contain the following configuration so that URLs don't require the `.html` extension:

```json title="vercel.json"
{
  "cleanUrls": true
}
</code></pre></div></div>

<h3 id="deploy-to-vercel">Deploy to Vercel</h3>

<ol>
  <li>Log in to the <a href="https://vercel.com/dashboard" rel="external nofollow noopener" target="_blank">Vercel Dashboard</a> and click “Add New…” &gt; Project</li>
  <li>Import the Git repository containing your Quartz project.</li>
  <li>Give the project a name (lowercase characters and hyphens only)</li>
  <li>Check that these configuration options are set:</li>
</ol>

<table>
  <thead>
    <tr>
      <th>Configuration option</th>
      <th>Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Framework Preset</td>
      <td><code class="language-plaintext highlighter-rouge">Other</code></td>
    </tr>
    <tr>
      <td>Root Directory</td>
      <td><code class="language-plaintext highlighter-rouge">./</code></td>
    </tr>
    <tr>
      <td>Build and Output Settings &gt; Build Command</td>
      <td><code class="language-plaintext highlighter-rouge">npx quartz build</code></td>
    </tr>
  </tbody>
</table>

<ol>
  <li>Press Deploy. Once it’s live, you’ll have 2 <code class="language-plaintext highlighter-rouge">*.vercel.app</code> URLs to view the page.</li>
</ol>

<h3 id="custom-domain">Custom Domain</h3>

<blockquote>
  <p>[!note]
If there is something already hosted on the domain, these steps will not work without replacing the previous content. As a workaround, you could use Next.js rewrites or use the next section to create a subdomain.</p>
</blockquote>

<ol>
  <li>Update the <code class="language-plaintext highlighter-rouge">baseUrl</code> in <code class="language-plaintext highlighter-rouge">quartz.config.js</code> if necessary.</li>
  <li>Go to the <a href="https://vercel.com/dashboard/domains" rel="external nofollow noopener" target="_blank">Domains - Dashboard</a> page in Vercel.</li>
  <li>Connect the domain to Vercel</li>
  <li>Press “Add” to connect a custom domain to Vercel.</li>
  <li>Select your Quartz repository and press Continue.</li>
  <li>Enter the domain you want to connect it to.</li>
  <li>Follow the instructions to update your DNS records until you see “Valid Configuration”</li>
</ol>

<h3 id="use-a-subdomain">Use a Subdomain</h3>

<p>Using <code class="language-plaintext highlighter-rouge">docs.example.com</code> is an example of a subdomain. They’re a simple way of connecting multiple deployments to one domain.</p>

<ol>
  <li>Update the <code class="language-plaintext highlighter-rouge">baseUrl</code> in <code class="language-plaintext highlighter-rouge">quartz.config.js</code> if necessary.</li>
  <li>Ensure your domain has been added to the <a href="https://vercel.com/dashboard/domains" rel="external nofollow noopener" target="_blank">Domains - Dashboard</a> page in Vercel.</li>
  <li>Go to the <a href="https://vercel.com/dashboard" rel="external nofollow noopener" target="_blank">Vercel Dashboard</a> and select your Quartz project.</li>
  <li>Go to the Settings tab and then click Domains in the sidebar</li>
  <li>Enter your subdomain into the field and press Add</li>
</ol>

<h2 id="netlify">Netlify</h2>

<ol>
  <li>Log in to the <a href="https://app.netlify.com/" rel="external nofollow noopener" target="_blank">Netlify dashboard</a> and click “Add new site”.</li>
  <li>Select your Git provider and repository containing your Quartz project.</li>
  <li>Under “Build command”, enter <code class="language-plaintext highlighter-rouge">npx quartz build</code>.</li>
  <li>Under “Publish directory”, enter <code class="language-plaintext highlighter-rouge">public</code>.</li>
  <li>Press Deploy. Once it’s live, you’ll have a <code class="language-plaintext highlighter-rouge">*.netlify.app</code> URL to view the page.</li>
  <li>To add a custom domain, check “Domain management” in the left sidebar, just like with Vercel.</li>
</ol>

<h2 id="gitlab-pages">GitLab Pages</h2>

<p>In your local Quartz, create a new file <code class="language-plaintext highlighter-rouge">.gitlab-ci.yaml</code>.</p>

<p>```yaml title=”.gitlab-ci.yaml”
stages:</p>
<ul>
  <li>build</li>
  <li>deploy</li>
</ul>

<p>variables:
  NODE_VERSION: “18.14”</p>

<p>build:
  stage: build
  rules:
    - if: ‘$CI_COMMIT_REF_NAME == “v4”’
  before_script:
    - apt-get update -q &amp;&amp; apt-get install -y nodejs npm
    - npm install -g n
    - n $NODE_VERSION
    - hash -r
    - npm ci
  script:
    - npx quartz build
  artifacts:
    paths:
      - public
  cache:
    paths:
      - ~/.npm/
    key: “${CI_COMMIT_REF_SLUG}-node-${CI_COMMIT_REF_NAME}”
  tags:
    - docker</p>

<p>pages:
  stage: deploy
  rules:
    - if: ‘$CI_COMMIT_REF_NAME == “v4”’
  script:
    - echo “Deploying to GitLab Pages…”
  artifacts:
    paths:
      - public</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
When `.gitlab-ci.yaml` is committed, GitLab will build and deploy the website as a GitLab Page. You can find the url under `Deploy &gt; Pages` in the sidebar.

By default, the page is private and only visible when logged in to a GitLab account with access to the repository but can be opened in the settings under `Deploy` -&gt; `Pages`.

## Self-Hosting

Copy the `public` directory to your web server and configure it to serve the files. You can use any web server to host your site. Since Quartz generates links that do not include the `.html` extension, you need to let your web server know how to deal with it.

### Using Nginx

Here's an example of how to do this with Nginx:

```nginx title="nginx.conf"
server {
    listen 80;
    server_name example.com;
    root /path/to/quartz/public;
    index index.html;
    error_page 404 /404.html;

    location / {
        try_files $uri $uri.html $uri/ =404;
    }
}
</code></pre></div></div>

<h3 id="using-caddy">Using Caddy</h3>

<p>Here’s and example of how to do this with Caddy:</p>

<p>```caddy title=”Caddyfile”
example.com {
    root * /path/to/quartz/public
    try_files {path} {path}.html {path}/ =404
    file_server
    encode gzip</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>handle_errors {
    rewrite * /{err.status_code}.html
    file_server
} } ```
</code></pre></div></div>
</body></html>
